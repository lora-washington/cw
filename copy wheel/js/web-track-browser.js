this["web-track-browser"]=function(){"use strict";function t(t,e,s){Object.defineProperty(t,e,{writable:!0,enumerable:!0,configurable:!0,value:s})}Array(32);class e{constructor(t){var e,s;this.timer=null,this.time=10,this.count=10,this.arr=[],this.time=null!=(e=t.time)?e:10,this.count=null!=(s=t.count)?s:10,this.url=t.host.startsWith("http://")||t.host.startsWith("https://")?t.host+"/logstores/"+t.logstore+"/track":"https://"+t.project+"."+t.host+"/logstores/"+t.logstore+"/track",this.opt=t,t.installUnloadHook&&"function"==typeof t.installUnloadHook&&t.installUnloadHook((()=>{this.sendImmediateInner()}))}assemblePayload(t){const e={__logs__:t};return this.opt.tags&&(e.__tags__=this.opt.tags),this.opt.topic&&(e.__topic__=this.opt.topic),this.opt.source&&(e.__source__=this.opt.source),JSON.stringify(e)}platformSend(){if(this.opt.sendPayload&&"function"==typeof this.opt.sendPayload){const t=this.assemblePayload(this.arr);this.opt.sendPayload(this.url,t)}}transString(t){let e={};for(let s in t)e[s]="object"==typeof t[s]?JSON.stringify(t[s]):String(t[s]);return e}sendImmediateInner(){this.arr&&this.arr.length>0&&(this.platformSend(),null!=this.timer&&(clearTimeout(this.timer),this.timer=null),this.arr=[])}sendInner(){if(this.timer)this.arr.length>=this.count&&(clearTimeout(this.timer),this.timer=null,this.sendImmediateInner());else{const t=this;this.arr.length>=this.count||this.time<=0?this.sendImmediateInner():this.timer=setTimeout((function(){t.sendImmediateInner()}),1e3*this.time)}}send(t){const e=this.transString(t);this.arr.push(e),this.sendInner()}sendImmediate(t){const e=this.transString(t);this.arr.push(e),this.sendImmediateInner()}sendBatchLogs(t){const e=t.map((t=>this.transString(t)));this.arr.push(...e),this.sendInner()}sendBatchLogsImmediate(t){const e=t.map((t=>this.transString(t)));this.arr.push(...e),this.sendImmediateInner()}overwriteTransString(t){this.transString=t.transString}getOpt(){return this.opt}}var s,n,i,o,r=(t,e,s)=>new Promise(((n,i)=>{var o=t=>{try{a(s.next(t))}catch(e){i(e)}},r=t=>{try{a(s.throw(t))}catch(e){i(e)}},a=t=>t.done?n(t.value):Promise.resolve(t.value).then(o,r);a((s=s.apply(t,e)).next())}));function a(t,e){const s=new window.XMLHttpRequest;s.open("POST",`${t}?APIVersion=0.6.0`,!0),s.send(e)}function l(t,e){try{if(e.length>=32768)return void a(t,e);(function(t,e){return!(!navigator||!navigator.sendBeacon)&&navigator.sendBeacon(`${t}?APIVersion=0.6.0`,e)})(t,e)||a(t,e)}catch(s){window&&window.console&&"function"==typeof window.console.error&&(console.error("Failed to log to ali log service because of this exception:\n"+s),console.error("Failed log data:",t))}}class h extends e{constructor(t){super(Object.assign({},t,{installUnloadHook:t=>{window.addEventListener("beforeunload",(()=>{t()}))},sendPayload:(t,e)=>{l(t,e)}}))}useStsPlugin(t){this.getOpt().sendPayload=(e,s)=>{!function(t,e,s){r(this,null,(function*(){try{t=t.slice(0,-6);const{data:n,header:i}=yield s.process(t,e),o=new window.XMLHttpRequest;o.open("POST",t,!0);for(let t in i)o.setRequestHeader(t,i[t]);o.send(n)}catch(n){window&&window.console&&"function"==typeof window.console.error&&(console.error("Failed to log to ali log service because of this exception:\n"+n),console.error("Failed log data:",t))}}))}(e,s,t)},this.overwriteTransString(t)}}return s=window,n="SLS_Tracker",i=h,o?o((()=>{t(s,n,i)})):t(s,n,i),h}();